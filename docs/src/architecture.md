# Architecture

It is important to note that the backend server is required due to the fact that proofs can not currently be generated client side. The backend is merely a proxy between Reclaim `zkTLS` attestors and the client, and technically anyone could run the server. As such, it doesn't harm the decentralization of **LazyDev_**.

## Repo Registration Flow

![Repo Registration Flow](static/reporegister.svg)

The admin of the repository first authenticates through GitHub and recieves an `access token`.

To set up the project, the repo admin needs to prove their GitHub user and the information that shows that they are the owner of the repository. To accomplish this, 2 proofs are sent to the contract:

### User proof

With the access token generated by GitHub, they send a request to backend with the token. Backend is only used as an proof worker, so Backend sends a request to `/user` endpoint with the corresponding access token through the Reclaim Client to get the proof of the request.

### Admin proof

The repository admin then sends another request to `/repos/{repoOwner}/{repo}` to prove that they have admin permissions for the repository, which is then verified on-chain to ensure that the user is able to set up the repository.

### Submission to the smart contract

The desired reward configuration is submitted along with the proofs, using the [commit/reveal scheme](./architecture/commit-reveal-scheme.md) to prevent front-running.

## Developer GitHub Account Linking

![GitHub User Account Linking Flow](static/usergithub.svg)

Users needs to link their GitHub account with their wallet adresses before claiming rewards. The process for the user is very similar to the project registration.

The user first authenticates through GitHub and get an `access token`.

To link the GitHub user with the wallet, user needs to prove their GitHub user and the information that shows that they are a valid GitHub user. They create the user proof to send to the contract.

### User proof

With the access token generated by GitHub, they send a request to backend with the token. The backend sends a request to the `/user` endpoint with the corresponding access token through the Reclaim Client to get the proof of the request.

### Submission to the smart contract

The desired recipient address is submitted along with the proofs, using the [commit/reveal scheme](./architecture/commit-reveal-scheme.md) to prevent front-running.

## Reward Distribution Flow

![Pr Reward Flow](static/prreward.svg)

To claim a reward, user must be registered in the smart contract as explained before

A `zkTLS` proof of the pull request data is required to ensure that the user actually opened PR and it is merged. The backend creates the pull request proof and returns it to the user.

The pull request proof is then submitted on-chain. If the proof is valid, the **LazyDev_** smart contract checks the labels of the PR and calls the corresponding reward contracts linked with the labels to distribute the rewards.

## Access Tokens

For any requests that use an access token, the access token is passed as a private option to the client. This ensures that the Reclaim attestors do not get access to the token.
